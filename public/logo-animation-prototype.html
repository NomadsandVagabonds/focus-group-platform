<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resonant Logo Animation v5</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        @font-face {
            font-family: 'Tiempos';
            src: url('/fonts/tiempos.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tiempos', 'Palatino Linotype', Georgia, serif;
            background: #FAF6F1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
        }

        h1 {
            color: #2D2A26;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .controls {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 10px 20px;
            font-size: 14px;
            border: 2px solid #9A3324;
            background: white;
            color: #9A3324;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
        }

        button:hover {
            background: #9A3324;
            color: white;
        }

        .animation-container {
            width: 450px;
            height: 450px;
            background: #FAF6F1;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .timer {
            font-size: 14px;
            color: #6B6560;
            margin-bottom: 10px;
        }

        .brand-preview {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-top: 30px;
            padding: 20px 40px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .brand-preview svg {
            width: 50px;
            height: 50px;
        }

        .brand-name {
            font-family: 'Tiempos', Georgia, serif;
            font-size: 2rem;
            font-weight: 400;
            color: #1A1A2E;
            letter-spacing: -0.02em;
        }
    </style>
</head>

<body>
    <h1>Resonant Logo Animation v5</h1>

    <div class="timer" id="timer">Ready</div>

    <div class="controls">
        <button onclick="playAnimation()">â–¶ Play Animation (~4s)</button>
        <button onclick="showScattered()">Scattered</button>
        <button onclick="showFormed()">Formed</button>
    </div>

    <div class="animation-container">
        <svg id="logo-canvas" width="400" height="400" viewBox="0 0 886 886"></svg>
    </div>

    <div class="brand-preview">
        <svg viewBox="0 0 886 886">
            <g id="static-logo" fill="#9A3324"></g>
        </svg>
        <span class="brand-name">Resonant</span>
    </div>

    <script>
        // Parse the exact circle centers from the vectorized SVG paths
        const pathData = `M734.00,780.00 L726.00,784.00 L718.00,794.00 L718.00,813.00 L728.00,825.00 L747.00,829.00 L763.00,817.00 L767.00,807.00 L765.00,794.00 L757.00,784.00 L749.00,780.00 L734.00,780.00 Z M338.00,778.00 L320.00,792.00 L318.00,815.00 L322.00,823.00 L336.00,833.00 L357.00,833.00 L367.00,827.00 L373.00,817.00 L373.00,794.00 L359.00,780.00 L338.00,778.00 Z M172.00,768.00 L162.00,772.00 L150.00,784.00 L146.00,794.00 L146.00,809.00 L150.00,819.00 L160.00,829.00 L183.00,835.00 L199.00,829.00 L211.00,813.00 L213.00,798.00 L207.00,782.00 L197.00,772.00 L187.00,768.00 L172.00,768.00 Z M652.00,760.00 L638.00,766.00 L624.00,784.00 L622.00,801.00 L626.00,815.00 L636.00,827.00 L648.00,833.00 L661.00,835.00 L681.00,829.00 L691.00,819.00 L697.00,805.00 L697.00,790.00 L693.00,778.00 L679.00,764.00 L669.00,760.00 L652.00,760.00 Z M254.00,760.00 L238.00,776.00 L238.00,793.00 L242.00,801.00 L254.00,809.00 L273.00,809.00 L287.00,795.00 L287.00,774.00 L279.00,764.00 L271.00,760.00 L254.00,760.00 Z M168.00,680.00 L160.00,684.00 L148.00,700.00 L146.00,713.00 L150.00,727.00 L168.00,741.00 L189.00,741.00 L197.00,737.00 L209.00,723.00 L209.00,698.00 L201.00,686.00 L189.00,680.00 L168.00,680.00 Z M734.00,668.00 L722.00,674.00 L712.00,684.00 L706.00,696.00 L706.00,717.00 L712.00,729.00 L722.00,739.00 L734.00,745.00 L755.00,745.00 L765.00,741.00 L779.00,727.00 L783.00,717.00 L783.00,696.00 L779.00,686.00 L765.00,672.00 L755.00,668.00 L734.00,668.00 Z M656.00,668.00 L644.00,672.00 L634.00,682.00 L630.00,690.00 L630.00,707.00 L634.00,717.00 L644.00,727.00 L654.00,731.00 L667.00,731.00 L685.00,721.00 L691.00,711.00 L693.00,696.00 L689.00,684.00 L677.00,672.00 L667.00,668.00 L656.00,668.00 Z M334.00,664.00 L322.00,670.00 L312.00,682.00 L310.00,709.00 L322.00,727.00 L336.00,733.00 L353.00,733.00 L363.00,729.00 L375.00,717.00 L379.00,707.00 L379.00,690.00 L375.00,680.00 L363.00,668.00 L355.00,664.00 L334.00,664.00 Z M256.00,658.00 L242.00,664.00 L236.00,670.00 L230.00,684.00 L230.00,699.00 L234.00,709.00 L244.00,719.00 L254.00,723.00 L273.00,723.00 L287.00,715.00 L295.00,703.00 L295.00,678.00 L281.00,662.00 L271.00,658.00 L256.00,658.00 Z M574.00,650.00 L558.00,656.00 L548.00,666.00 L542.00,680.00 L542.00,697.00 L548.00,711.00 L558.00,721.00 L574.00,727.00 L585.00,727.00 L601.00,721.00 L613.00,709.00 L617.00,699.00 L617.00,678.00 L611.00,666.00 L601.00,656.00 L585.00,650.00 L574.00,650.00 Z M172.00,590.00 L162.00,594.00 L152.00,604.00 L148.00,612.00 L148.00,631.00 L150.00,637.00 L162.00,649.00 L183.00,653.00 L203.00,643.00 L211.00,627.00 L211.00,614.00 L207.00,604.00 L193.00,592.00 L172.00,590.00 Z M594.00,582.00 L586.00,586.00 L576.00,600.00 L576.00,623.00 L586.00,637.00 L600.00,643.00 L615.00,643.00 L633.00,631.00 L639.00,615.00 L637.00,600.00 L619.00,582.00 L594.00,582.00 Z M680.00,574.00 L666.00,580.00 L656.00,590.00 L650.00,604.00 L650.00,621.00 L658.00,637.00 L670.00,647.00 L682.00,651.00 L697.00,651.00 L711.00,645.00 L723.00,633.00 L727.00,623.00 L727.00,602.00 L723.00,592.00 L711.00,580.00 L697.00,574.00 L680.00,574.00 Z M334.00,572.00 L322.00,578.00 L312.00,590.00 L310.00,617.00 L326.00,637.00 L338.00,641.00 L351.00,641.00 L365.00,635.00 L375.00,625.00 L379.00,617.00 L379.00,596.00 L371.00,582.00 L353.00,572.00 L334.00,572.00 Z M254.00,562.00 L232.00,576.00 L226.00,590.00 L226.00,605.00 L232.00,619.00 L240.00,627.00 L254.00,633.00 L271.00,633.00 L283.00,627.00 L293.00,617.00 L297.00,609.00 L297.00,588.00 L293.00,578.00 L281.00,566.00 L271.00,562.00 L254.00,562.00 Z M508.00,562.00 L494.00,574.00 L488.00,584.00 L486.00,603.00 L492.00,619.00 L500.00,629.00 L518.00,637.00 L533.00,637.00 L549.00,631.00 L559.00,621.00 L565.00,607.00 L565.00,590.00 L559.00,576.00 L549.00,566.00 L537.00,560.00 L508.00,562.00 Z M642.00,498.00 L632.00,502.00 L624.00,510.00 L620.00,520.00 L620.00,533.00 L624.00,543.00 L632.00,551.00 L642.00,555.00 L657.00,555.00 L675.00,541.00 L677.00,518.00 L665.00,502.00 L655.00,498.00 L642.00,498.00 Z M164.00,498.00 L152.00,508.00 L146.00,522.00 L150.00,543.00 L168.00,557.00 L189.00,557.00 L197.00,553.00 L209.00,539.00 L211.00,531.00 L207.00,510.00 L197.00,500.00 L187.00,496.00 L164.00,498.00 Z M560.00,482.00 L546.00,488.00 L534.00,500.00 L528.00,516.00 L530.00,533.00 L536.00,545.00 L556.00,559.00 L581.00,559.00 L601.00,545.00 L607.00,533.00 L607.00,510.00 L601.00,498.00 L591.00,488.00 L577.00,482.00 L560.00,482.00 Z M336.00,478.00 L322.00,484.00 L314.00,492.00 L308.00,506.00 L308.00,521.00 L318.00,539.00 L332.00,547.00 L349.00,549.00 L361.00,545.00 L371.00,537.00 L379.00,521.00 L379.00,506.00 L373.00,492.00 L365.00,484.00 L353.00,478.00 L336.00,478.00 Z M466.00,478.00 L456.00,484.00 L446.00,496.00 L442.00,510.00 L444.00,529.00 L448.00,537.00 L466.00,551.00 L499.00,551.00 L511.00,543.00 L519.00,531.00 L521.00,504.00 L515.00,492.00 L497.00,478.00 L466.00,478.00 Z M254.00,472.00 L240.00,478.00 L230.00,488.00 L224.00,504.00 L226.00,521.00 L230.00,529.00 L244.00,541.00 L273.00,543.00 L293.00,527.00 L297.00,517.00 L297.00,500.00 L289.00,484.00 L279.00,476.00 L267.00,472.00 L254.00,472.00 Z M160.00,410.00 L146.00,430.00 L146.00,449.00 L150.00,459.00 L160.00,469.00 L178.00,475.00 L191.00,473.00 L203.00,467.00 L215.00,447.00 L215.00,432.00 L209.00,418.00 L191.00,406.00 L168.00,406.00 L160.00,410.00 Z M636.00,404.00 L622.00,410.00 L610.00,424.00 L606.00,436.00 L606.00,451.00 L614.00,469.00 L626.00,479.00 L636.00,483.00 L655.00,483.00 L669.00,477.00 L681.00,465.00 L687.00,451.00 L687.00,436.00 L677.00,416.00 L667.00,408.00 L657.00,404.00 L636.00,404.00 Z M722.00,396.00 L714.00,400.00 L706.00,410.00 L706.00,433.00 L712.00,441.00 L720.00,445.00 L739.00,445.00 L753.00,431.00 L753.00,412.00 L741.00,398.00 L722.00,396.00 Z M332.00,390.00 L314.00,402.00 L308.00,414.00 L308.00,435.00 L316.00,449.00 L332.00,459.00 L355.00,459.00 L369.00,451.00 L379.00,433.00 L379.00,416.00 L373.00,404.00 L363.00,394.00 L353.00,390.00 L332.00,390.00 Z M254.00,386.00 L240.00,392.00 L228.00,406.00 L226.00,433.00 L242.00,453.00 L252.00,457.00 L271.00,457.00 L281.00,453.00 L293.00,441.00 L299.00,420.00 L295.00,406.00 L283.00,392.00 L267.00,386.00 L254.00,386.00 Z M630.00,318.00 L616.00,324.00 L606.00,334.00 L600.00,346.00 L600.00,369.00 L606.00,381.00 L620.00,393.00 L632.00,397.00 L649.00,397.00 L663.00,391.00 L675.00,379.00 L681.00,354.00 L675.00,336.00 L663.00,324.00 L651.00,318.00 L630.00,318.00 Z M720.00,310.00 L706.00,316.00 L694.00,328.00 L688.00,344.00 L688.00,355.00 L694.00,371.00 L704.00,381.00 L718.00,387.00 L737.00,387.00 L759.00,373.00 L767.00,355.00 L767.00,344.00 L761.00,328.00 L749.00,316.00 L735.00,310.00 L720.00,310.00 Z M172.00,308.00 L162.00,312.00 L150.00,324.00 L146.00,334.00 L146.00,353.00 L152.00,365.00 L162.00,373.00 L174.00,377.00 L187.00,377.00 L201.00,371.00 L209.00,363.00 L215.00,351.00 L215.00,336.00 L209.00,322.00 L201.00,314.00 L189.00,308.00 L172.00,308.00 Z M336.00,306.00 L326.00,310.00 L314.00,322.00 L308.00,345.00 L314.00,361.00 L324.00,371.00 L332.00,375.00 L349.00,377.00 L365.00,371.00 L375.00,361.00 L379.00,353.00 L379.00,330.00 L365.00,312.00 L351.00,306.00 L336.00,306.00 Z M250.00,306.00 L232.00,320.00 L226.00,334.00 L226.00,349.00 L230.00,359.00 L242.00,371.00 L252.00,375.00 L273.00,375.00 L287.00,367.00 L297.00,351.00 L297.00,332.00 L293.00,322.00 L281.00,310.00 L273.00,306.00 L250.00,306.00 Z M612.00,232.00 L598.00,240.00 L588.00,254.00 L588.00,289.00 L602.00,305.00 L614.00,311.00 L639.00,311.00 L651.00,305.00 L665.00,287.00 L665.00,256.00 L651.00,238.00 L639.00,232.00 L612.00,232.00 Z M232.00,238.00 L226.00,250.00 L226.00,271.00 L230.00,281.00 L250.00,295.00 L279.00,293.00 L291.00,283.00 L297.00,271.00 L297.00,252.00 L293.00,242.00 L273.00,226.00 L250.00,226.00 L232.00,238.00 Z M166.00,228.00 L148.00,246.00 L146.00,271.00 L152.00,283.00 L170.00,295.00 L193.00,295.00 L201.00,291.00 L215.00,275.00 L215.00,248.00 L203.00,232.00 L191.00,226.00 L166.00,228.00 Z M716.00,224.00 L702.00,232.00 L692.00,244.00 L688.00,256.00 L688.00,271.00 L694.00,285.00 L706.00,297.00 L726.00,303.00 L741.00,301.00 L753.00,295.00 L767.00,275.00 L767.00,252.00 L759.00,236.00 L749.00,228.00 L739.00,224.00 L716.00,224.00 Z M326.00,228.00 L314.00,238.00 L308.00,250.00 L310.00,277.00 L320.00,289.00 L332.00,295.00 L355.00,295.00 L371.00,285.00 L379.00,269.00 L379.00,252.00 L375.00,242.00 L355.00,226.00 L340.00,224.00 L326.00,228.00 Z M576.00,152.00 L564.00,158.00 L552.00,170.00 L546.00,184.00 L546.00,201.00 L552.00,215.00 L564.00,227.00 L578.00,233.00 L597.00,233.00 L607.00,229.00 L621.00,217.00 L627.00,203.00 L627.00,182.00 L621.00,168.00 L607.00,156.00 L597.00,152.00 L576.00,152.00 Z M170.00,146.00 L150.00,162.00 L146.00,172.00 L146.00,189.00 L154.00,205.00 L170.00,215.00 L193.00,215.00 L201.00,211.00 L215.00,195.00 L215.00,166.00 L201.00,150.00 L193.00,146.00 L170.00,146.00 Z M496.00,144.00 L484.00,148.00 L472.00,158.00 L466.00,170.00 L466.00,193.00 L480.00,211.00 L494.00,217.00 L509.00,217.00 L523.00,211.00 L533.00,201.00 L539.00,180.00 L537.00,170.00 L525.00,152.00 L507.00,144.00 L496.00,144.00 Z M404.00,146.00 L394.00,152.00 L384.00,166.00 L384.00,195.00 L398.00,211.00 L406.00,215.00 L431.00,215.00 L439.00,211.00 L453.00,193.00 L453.00,166.00 L447.00,156.00 L433.00,146.00 L404.00,146.00 Z M334.00,144.00 L322.00,148.00 L308.00,162.00 L304.00,172.00 L304.00,189.00 L308.00,199.00 L320.00,211.00 L330.00,215.00 L349.00,215.00 L359.00,211.00 L371.00,199.00 L375.00,191.00 L375.00,170.00 L369.00,158.00 L357.00,148.00 L334.00,144.00 Z M248.00,146.00 L240.00,150.00 L226.00,168.00 L226.00,193.00 L230.00,201.00 L244.00,213.00 L277.00,213.00 L291.00,201.00 L295.00,193.00 L295.00,168.00 L291.00,160.00 L273.00,146.00 L248.00,146.00 Z M688.00,142.00 L676.00,148.00 L662.00,164.00 L662.00,199.00 L676.00,215.00 L684.00,219.00 L715.00,219.00 L733.00,205.00 L739.00,193.00 L739.00,170.00 L733.00,158.00 L723.00,148.00 L711.00,142.00 L688.00,142.00 Z M644.00,82.00 L628.00,90.00 L618.00,106.00 L618.00,123.00 L622.00,133.00 L632.00,143.00 L642.00,147.00 L661.00,147.00 L673.00,141.00 L681.00,131.00 L685.00,119.00 L683.00,104.00 L671.00,88.00 L657.00,82.00 L644.00,82.00 Z M396.00,72.00 L386.00,82.00 L380.00,98.00 L380.00,109.00 L388.00,125.00 L394.00,131.00 L408.00,137.00 L427.00,137.00 L437.00,133.00 L447.00,123.00 L453.00,109.00 L453.00,94.00 L449.00,84.00 L429.00,68.00 L404.00,68.00 L396.00,72.00 Z M244.00,70.00 L230.00,82.00 L226.00,90.00 L224.00,107.00 L228.00,119.00 L236.00,129.00 L252.00,137.00 L271.00,137.00 L283.00,131.00 L291.00,123.00 L297.00,109.00 L297.00,96.00 L291.00,82.00 L273.00,68.00 L244.00,70.00 Z M170.00,68.00 L150.00,84.00 L146.00,94.00 L146.00,109.00 L152.00,123.00 L160.00,131.00 L174.00,137.00 L189.00,137.00 L203.00,131.00 L211.00,123.00 L217.00,109.00 L217.00,94.00 L213.00,84.00 L201.00,72.00 L193.00,68.00 L170.00,68.00 Z M564.00,66.00 L550.00,72.00 L538.00,86.00 L536.00,115.00 L542.00,127.00 L554.00,137.00 L566.00,141.00 L579.00,141.00 L593.00,135.00 L603.00,125.00 L609.00,109.00 L609.00,98.00 L603.00,82.00 L593.00,72.00 L579.00,66.00 L564.00,66.00 Z M488.00,66.00 L474.00,72.00 L464.00,82.00 L458.00,96.00 L458.00,107.00 L464.00,123.00 L472.00,131.00 L484.00,137.00 L505.00,137.00 L515.00,133.00 L525.00,123.00 L531.00,109.00 L531.00,96.00 L527.00,84.00 L513.00,70.00 L501.00,66.00 L488.00,66.00 Z M326.00,68.00 L318.00,72.00 L306.00,86.00 L304.00,113.00 L308.00,121.00 L324.00,135.00 L355.00,135.00 L369.00,123.00 L373.00,115.00 L373.00,88.00 L363.00,74.00 L351.00,68.00 L326.00,68.00 Z`;

        // Parse paths to extract circle centers
        function parsePathsToCircles(pathStr) {
            const circles = [];
            const pathSegments = pathStr.split(' Z ');

            pathSegments.forEach((segment, i) => {
                if (!segment.trim()) return;

                const coords = [];
                const regex = /(\d+\.?\d*),(\d+\.?\d*)/g;
                let match;
                while ((match = regex.exec(segment)) !== null) {
                    coords.push({ x: parseFloat(match[1]), y: parseFloat(match[2]) });
                }

                if (coords.length > 0) {
                    const minX = Math.min(...coords.map(c => c.x));
                    const maxX = Math.max(...coords.map(c => c.x));
                    const minY = Math.min(...coords.map(c => c.y));
                    const maxY = Math.max(...coords.map(c => c.y));

                    const cx = (minX + maxX) / 2;
                    const cy = (minY + maxY) / 2;
                    const r = Math.max(maxX - minX, maxY - minY) / 2;

                    circles.push({ cx, cy, r, id: i });
                }
            });

            return circles;
        }

        const circleData = parsePathsToCircles(pathData);
        console.log(`Extracted ${circleData.length} circles from SVG paths`);

        const svg = d3.select("#logo-canvas");
        const viewBox = { width: 886, height: 886 };

        // Create dots with smooth flying trajectories
        let dots = circleData.map(c => {
            // Give each dot a random initial position and velocity (flying direction)
            const angle = Math.random() * Math.PI * 2;
            const speed = 2 + Math.random() * 4; // Varying speeds
            return {
                ...c,
                targetX: c.cx,
                targetY: c.cy,
                x: Math.random() * viewBox.width,
                y: Math.random() * viewBox.height,
                vx: Math.cos(angle) * speed,
                vy: Math.sin(angle) * speed
            };
        });

        const circles = svg.selectAll("circle")
            .data(dots)
            .enter()
            .append("circle")
            .attr("r", d => d.r)
            .attr("fill", "#9A3324")  // Red dots on cream
            .attr("cx", d => d.x)
            .attr("cy", d => d.y);

        // Populate static logo
        const staticLogo = d3.select("#static-logo");
        staticLogo.selectAll("circle")
            .data(circleData)
            .enter()
            .append("circle")
            .attr("r", d => d.r)
            .attr("cx", d => d.cx)
            .attr("cy", d => d.cy);

        let animationFrame = null;
        let animationStartTime = null;
        let attractionStrength = 0;

        function updateTimer(phase) {
            document.getElementById('timer').textContent = phase;
        }

        function playAnimation() {
            if (animationFrame) cancelAnimationFrame(animationFrame);
            updateTimer('Flying...');
            animationStartTime = Date.now();
            attractionStrength = 0;

            // Scatter dots with smooth flying velocities
            dots.forEach(d => {
                d.x = Math.random() * viewBox.width;
                d.y = Math.random() * viewBox.height;
                // Give each dot a random direction and speed
                const angle = Math.random() * Math.PI * 2;
                const speed = 3 + Math.random() * 5;
                d.vx = Math.cos(angle) * speed;
                d.vy = Math.sin(angle) * speed;
            });

            circles.attr("cx", d => d.x).attr("cy", d => d.y);

            const totalDuration = 4000;
            const chaosPhase = 1800;

            function tick() {
                const elapsed = Date.now() - animationStartTime;

                // Calculate attraction strength
                if (elapsed < chaosPhase) {
                    attractionStrength = 0;
                    updateTimer(`Flying... ${((chaosPhase - elapsed) / 1000).toFixed(1)}s`);
                } else if (elapsed < totalDuration) {
                    attractionStrength = Math.pow((elapsed - chaosPhase) / (totalDuration - chaosPhase), 2);
                    updateTimer(`Coalescing... ${Math.round(attractionStrength * 100)}%`);
                } else {
                    // Final snap
                    cancelAnimationFrame(animationFrame);

                    circles.transition()
                        .duration(300)
                        .ease(d3.easeQuadOut)
                        .attr("cx", d => d.targetX)
                        .attr("cy", d => d.targetY)
                        .on("end", function (event, d) {
                            if (d.id === 0) {
                                const elapsed = ((Date.now() - animationStartTime) / 1000).toFixed(1);
                                updateTimer(`Complete! (${elapsed}s)`);

                                circles.transition()
                                    .duration(120)
                                    .attr("r", d => d.r * 1.05)
                                    .transition()
                                    .duration(120)
                                    .attr("r", d => d.r);
                            }
                        });
                    return;
                }

                // Update physics
                dots.forEach(d => {
                    // Apply attraction toward target
                    const dx = d.targetX - d.x;
                    const dy = d.targetY - d.y;
                    d.vx += dx * attractionStrength * 0.008;
                    d.vy += dy * attractionStrength * 0.008;

                    // Apply damping (increases as we get closer to target)
                    const damping = 0.98 - attractionStrength * 0.02;
                    d.vx *= damping;
                    d.vy *= damping;

                    // Update position
                    d.x += d.vx;
                    d.y += d.vy;

                    // Soft bounce off edges
                    if (d.x < 30) { d.x = 30; d.vx *= -0.8; }
                    if (d.x > viewBox.width - 30) { d.x = viewBox.width - 30; d.vx *= -0.8; }
                    if (d.y < 30) { d.y = 30; d.vy *= -0.8; }
                    if (d.y > viewBox.height - 30) { d.y = viewBox.height - 30; d.vy *= -0.8; }
                });

                // Render
                circles.attr("cx", d => d.x).attr("cy", d => d.y);

                animationFrame = requestAnimationFrame(tick);
            }

            animationFrame = requestAnimationFrame(tick);
        }

        function showScattered() {
            if (animationFrame) cancelAnimationFrame(animationFrame);
            updateTimer('Scattered');

            dots.forEach(d => {
                d.x = Math.random() * viewBox.width;
                d.y = Math.random() * viewBox.height;
            });
            circles.transition().duration(500)
                .attr("cx", d => d.x)
                .attr("cy", d => d.y);
        }

        function showFormed() {
            if (animationFrame) cancelAnimationFrame(animationFrame);
            updateTimer('Formed');
            circles.transition().duration(800)
                .ease(d3.easeQuadOut)
                .attr("cx", d => d.targetX)
                .attr("cy", d => d.targetY);
        }

        // Auto-play on load
        setTimeout(playAnimation, 500);
    </script>
</body>

</html>